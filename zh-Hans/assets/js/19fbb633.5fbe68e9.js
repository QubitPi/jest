"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[391],{3023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(3696);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},7151:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"upgrading-to-jest30","title":"From v29 to v30","description":"Upgrading Jest from v29 to v30? This guide aims to help refactoring your configuration and tests.","source":"@site/../docs/UpgradingToJest30.md","sourceDirName":".","slug":"/upgrading-to-jest30","permalink":"/zh-Hans/docs/next/upgrading-to-jest30","draft":false,"unlisted":false,"editUrl":"https://crowdin.com/project/jest-v2/zh-CN","tags":[],"version":"current","lastUpdatedBy":"Jiaqi Liu","lastUpdatedAt":1753661425000,"frontMatter":{"id":"upgrading-to-jest30","title":"From v29 to v30"},"sidebar":"docs","previous":{"title":"From v28 to v29","permalink":"/zh-Hans/docs/next/upgrading-to-jest29"}}');var i=t(2540),o=t(3023);const r={id:"upgrading-to-jest30",title:"From v29 to v30"},a=void 0,d={},c=[{value:"Compatibility",id:"compatibility",level:2},{value:"Jest Expect &amp; Matchers",id:"jest-expect--matchers",level:2},{value:"Removal of Alias Matcher Functions",id:"removal-of-alias-matcher-functions",level:3},{value:"Non-enumerable properties",id:"non-enumerable-properties",level:3},{value:"Improved Type Inference for CalledWith",id:"improved-type-inference-for-calledwith",level:3},{value:"Configuration Updates",id:"configuration-updates",level:2},{value:"Support for <code>.mts</code> and <code>.cts</code> File Extensions",id:"support-for-mts-and-cts-file-extensions",level:3},{value:"<code>--testPathPattern</code> was renamed to <code>--testPathPatterns</code>",id:"--testpathpattern-was-renamed-to---testpathpatterns",level:3},{value:"Removed <code>--init</code> Command",id:"removed---init-command",level:3},{value:"Other CLI Changes",id:"other-cli-changes",level:3},{value:"Test Runner Behavior Changes",id:"test-runner-behavior-changes",level:2},{value:"Unhandled Promise Rejections in Tests",id:"unhandled-promise-rejections-in-tests",level:3},{value:"Custom Test Sequencers",id:"custom-test-sequencers",level:3},{value:"Required <code>globalConfig</code> in Runtime",id:"required-globalconfig-in-runtime",level:3},{value:"Snapshots and Output Changes",id:"snapshots-and-output-changes",level:2},{value:"Update broken documentation link",id:"update-broken-documentation-link",level:3},{value:"Error Causes in Snapshots",id:"error-causes-in-snapshots",level:3},{value:"React Empty String Rendering",id:"react-empty-string-rendering",level:3},{value:"Improved Object Printing in <code>pretty-format</code>",id:"improved-object-printing-in-pretty-format",level:3},{value:"Jest Mock API Changes",id:"jest-mock-api-changes",level:2},{value:"<code>jest.genMockFromModule</code> Removed",id:"jestgenmockfrommodule-removed",level:3},{value:"Removed Mock Function Types",id:"removed-mock-function-types",level:3},{value:"Module &amp; Runtime Changes",id:"module--runtime-changes",level:2},{value:"ESM Module Support and Internal Restructuring",id:"esm-module-support-and-internal-restructuring",level:3},{value:"Glob Pattern Matching Changes",id:"glob-pattern-matching-changes",level:3},{value:"Conclusion",id:"conclusion",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Upgrading Jest from v29 to v30? This guide aims to help refactoring your configuration and tests."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/jestjs/jest/blob/main/CHANGELOG.md#3000",children:"changelog"})," for the full list of changes."]})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Upgrading from an older version? You can see the upgrade guide from v28 to v29 ",(0,i.jsx)(n.a,{href:"/docs/upgrading-to-jest29",children:"here"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"compatibility",children:"Compatibility"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Jest 30 drops support for Node 14, 16, 19, and 21. The minimum supported Node versions are now 18.x. Ensure your environment is using a compatible Node release before upgrading."}),"\n",(0,i.jsx)(n.li,{children:"The minimum TypeScript version is now 5.4. Update TypeScript, if you are using type definitions of Jest (or any of its packages)."}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"jest-environment-jsdom"})," package now uses JSDOM v26. This update may introduce behavior changes in the DOM environment. If you encounter differences in DOM behavior or new warnings, refer to the JSDOM release notes for ",(0,i.jsx)(n.a,{href:"https://github.com/jsdom/jsdom/compare/21.0.0...26.0.0",children:"v21\u201326"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"jest-expect--matchers",children:"Jest Expect & Matchers"}),"\n",(0,i.jsx)(n.h3,{id:"removal-of-alias-matcher-functions",children:"Removal of Alias Matcher Functions"}),"\n",(0,i.jsxs)(n.p,{children:["All ",(0,i.jsx)(n.em,{children:"alias"})," matcher names have been removed in favor of their primary names. If you have been using older, deprecated matcher names, you will need to update your tests:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Removed aliases and their replacements:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toBeCalled()"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveBeenCalled()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toBeCalledTimes(n)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveBeenCalledTimes(n)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toBeCalledWith(arg)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveBeenCalledWith(arg)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).lastCalledWith(arg)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveBeenLastCalledWith(arg)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).nthCalledWith(n, arg)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveBeenNthCalledWith(n, arg)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toReturn()"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveReturned()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toReturnTimes(n)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveReturnedTimes(n)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).toReturnWith(val)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveReturnedWith(val)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).lastReturnedWith(val)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveLastReturnedWith(val)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(fn).nthReturnedWith(n, val)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(fn).toHaveNthReturnedWith(n, val)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"expect(func).toThrowError(message)"})," ",(0,i.jsx)(n.strong,{children:"\u2192"})," ",(0,i.jsx)(n.code,{children:"expect(func).toThrow(message)"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["These alias methods were deprecated since Jest 26, and in Jest 30 they are fully removed. Perform a global search-and-replace in your codebase to update to the canonical matcher names. The functionality is identical \u2014 only the method names have changed. (If you use ESLint with ",(0,i.jsx)(n.code,{children:"eslint-plugin-jest"}),", the ",(0,i.jsx)(n.a,{href:"https://github.com/jest-community/eslint-plugin-jest/blob/HEAD/docs/rules/no-alias-methods.md",children:(0,i.jsx)(n.code,{children:"no-alias-methods"})})," rule can help automate this replacement.)"]})}),"\n",(0,i.jsx)(n.h3,{id:"non-enumerable-properties",children:"Non-enumerable properties"}),"\n",(0,i.jsxs)(n.p,{children:["Non-enumerable object properties are now excluded from object matchers by default. This could affect ",(0,i.jsx)(n.code,{children:"expect.objectContaining"})," or equality checks."]}),"\n",(0,i.jsx)(n.h3,{id:"improved-type-inference-for-calledwith",children:"Improved Type Inference for CalledWith"}),"\n",(0,i.jsxs)(n.p,{children:["TypeScript users: The types for the ",(0,i.jsx)(n.code,{children:"CalledWith"})," family of matchers (e.g. ",(0,i.jsx)(n.code,{children:"toHaveBeenCalledWith"}),") have been improved to infer function parameter types. In most cases this will catch type mismatches more accurately. This is a ",(0,i.jsx)(n.strong,{children:"compile-time"})," breaking change."]}),"\n",(0,i.jsxs)(n.p,{children:["If you were asserting calls with arguments that don\u2019t match the actual function\u2019s parameter types, TypeScript may now error on those tests. For example, if a function is typed to accept a number and you wrote ",(0,i.jsx)(n.code,{children:'expect(fn).toHaveBeenCalledWith("string")'}),", TypeScript 5 + Jest 30\u2019s types will flag this. The runtime behavior of the matcher is unchanged."]}),"\n",(0,i.jsx)(n.p,{children:"To fix new TypeScript errors, ensure your test arguments align with the function\u2019s expected types (or use type casts if you intentionally call with different types)."}),"\n",(0,i.jsx)(n.p,{children:"This change doesn\u2019t impact runtime, but it can surface new type errors in your tests that were previously unnoticed, making your tests more type-safe."}),"\n",(0,i.jsx)(n.h2,{id:"configuration-updates",children:"Configuration Updates"}),"\n",(0,i.jsxs)(n.h3,{id:"support-for-mts-and-cts-file-extensions",children:["Support for ",(0,i.jsx)(n.code,{children:".mts"})," and ",(0,i.jsx)(n.code,{children:".cts"})," File Extensions"]}),"\n",(0,i.jsx)(n.p,{children:"Jest 30 expands support for ESM and TypeScript module file extensions:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The default ",(0,i.jsx)(n.code,{children:"moduleFileExtensions"})," now include ",(0,i.jsx)(n.code,{children:".mts"})," and ",(0,i.jsx)(n.code,{children:".cts"})," (TypeScript ESM and CommonJS modules) in addition to the usual extensions."]}),"\n",(0,i.jsxs)(n.li,{children:["The default ",(0,i.jsx)(n.code,{children:"testMatch"})," and ",(0,i.jsx)(n.code,{children:"testRegex"})," patterns have been updated to recognize ",(0,i.jsx)(n.code,{children:".mjs"}),", ",(0,i.jsx)(n.code,{children:".cjs"}),", ",(0,i.jsx)(n.code,{children:".mts"}),", and ",(0,i.jsx)(n.code,{children:".cts"})," files as test files."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["If your project contains files with these extensions that are ",(0,i.jsx)(n.strong,{children:"not"})," intended to be treated as modules or tests, you may need to adjust your configuration. Conversely, if you have test files with these extensions, Jest will now detect them by default (you may remove custom configuration that was previously needed to include them)."]})}),"\n",(0,i.jsxs)(n.h3,{id:"--testpathpattern-was-renamed-to---testpathpatterns",children:[(0,i.jsx)(n.code,{children:"--testPathPattern"})," was renamed to ",(0,i.jsx)(n.code,{children:"--testPathPatterns"})]}),"\n",(0,i.jsxs)(n.p,{children:["If you filter tests by path, note that the CLI flag has changed: The ",(0,i.jsx)(n.code,{children:"--testPathPattern"})," flag is now ",(0,i.jsx)(n.code,{children:"--testPathPatterns"}),". You can pass multiple patterns by separating them with spaces or by repeating the flag. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Old (Jest 29)\njest --testPathPattern="unit/.*"\n\n# New (Jest 30)\njest --testPathPatterns "unit/.*" "integration/.*"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Internally, Jest consolidates these patterns into a ",(0,i.jsx)(n.code,{children:"TestPathPatterns"})," object. If you were programmatically calling Jest\u2019s watch mode with a ",(0,i.jsx)(n.code,{children:"testPathPattern"}),", you must now construct a ",(0,i.jsx)(n.code,{children:"TestPathPatterns"})," instance instead."]}),"\n",(0,i.jsxs)(n.h3,{id:"removed---init-command",children:["Removed ",(0,i.jsx)(n.code,{children:"--init"})," Command"]}),"\n",(0,i.jsxs)(n.p,{children:["The interactive config initialization command ",(0,i.jsx)(n.code,{children:"jest --init"})," has been ",(0,i.jsx)(n.strong,{children:"removed"}),". This deprecated command was used to scaffold a Jest configuration file. If you need to create a config, you can run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm init jest@latest\n# Or for Yarn\nyarn create jest\n# Or for pnpm\npnpm create jest\n"})}),"\n",(0,i.jsx)(n.h3,{id:"other-cli-changes",children:"Other CLI Changes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Jest now validates CLI flags that require arguments to ensure an argument is provided. For example, if you use ",(0,i.jsx)(n.code,{children:"--maxWorkers"})," or ",(0,i.jsx)(n.code,{children:"--selectProjects"}),", you must include a value (e.g. ",(0,i.jsx)(n.code,{children:"--maxWorkers=50%"}),"). Previously, Jest might have allowed certain flags without a value (falling back to defaults); now it will throw an error if the value is missing. Ensure any scripts or npm commands passing Jest flags include the necessary arguments."]}),"\n",(0,i.jsxs)(n.li,{children:["If you use the ",(0,i.jsx)(n.code,{children:"--filter"})," option to filter test files (an advanced use-case where you provide a path to a filter implementation), the expected interface has changed. The filter function should now return an object of shape ",(0,i.jsx)(n.code,{children:"{filtered: Array<string>}"}),", matching the documented format. In prior versions, a different return format may have been accepted (e.g., returning an array directly). Update any custom test filter functions to return an object with a ",(0,i.jsx)(n.code,{children:"filtered"})," property as documented."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-runner-behavior-changes",children:"Test Runner Behavior Changes"}),"\n",(0,i.jsx)(n.h3,{id:"unhandled-promise-rejections-in-tests",children:"Unhandled Promise Rejections in Tests"}),"\n",(0,i.jsx)(n.p,{children:"Jest includes a fix to properly handle promises that are rejected and later caught, to avoid false test failures. In Jest 29, a promise rejection that was handled asynchronously (after the test tick) could still cause the test to fail erroneously. Jest 30 now waits an extra event loop turn to confirm that a promise rejection remains unhandled before failing a test."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["You should see fewer false positives for unhandled promise rejections. Tests that previously failed due to async handled rejections should now pass. However, this change can slightly slow down test completion, especially in tests that intentionally reject promises. To mitigate performance impact, a new configuration flag ",(0,i.jsx)(n.code,{children:"waitForUnhandledRejections"})," was introduced. This flag, when disabled, can restore the previous behavior (not waiting) if absolutely needed. Most users should not need to change this \u2013 the default now favors correctness by preventing false failures."]})}),"\n",(0,i.jsx)(n.h3,{id:"custom-test-sequencers",children:"Custom Test Sequencers"}),"\n",(0,i.jsxs)(n.p,{children:["If you have a ",(0,i.jsx)(n.strong,{children:"custom test sequencer"})," (a class inheriting from Jest\u2019s ",(0,i.jsx)(n.code,{children:"TestSequencer"}),"), you\u2019ll need to update it for Jest 30. Jest now passes additional context to the test sequencer. Specifically, the ",(0,i.jsx)(n.code,{children:"TestSequencer"})," API was extended to expose the ",(0,i.jsx)(n.code,{children:"globalConfig"})," and ",(0,i.jsx)(n.code,{children:"contexts"})," to your sequencer."]}),"\n",(0,i.jsxs)(n.h3,{id:"required-globalconfig-in-runtime",children:["Required ",(0,i.jsx)(n.code,{children:"globalConfig"})," in Runtime"]}),"\n",(0,i.jsxs)(n.p,{children:["For those using Jest\u2019s programmatic APIs: constructing a ",(0,i.jsx)(n.code,{children:"Runtime"})," now requires a ",(0,i.jsx)(n.code,{children:"globalConfig"})," parameter. If you use ",(0,i.jsx)(n.code,{children:"jest.runCLI"})," or similar helpers, make sure you pass all required options as per the updated API. (The typical ",(0,i.jsx)(n.code,{children:"jest"})," CLI or ",(0,i.jsx)(n.code,{children:"npm test"})," usage is unaffected by this change.)"]}),"\n",(0,i.jsx)(n.h2,{id:"snapshots-and-output-changes",children:"Snapshots and Output Changes"}),"\n",(0,i.jsx)(n.h3,{id:"update-broken-documentation-link",children:"Update broken documentation link"}),"\n",(0,i.jsx)(n.p,{children:"Deprecated goo.gl URL is removed from snapshot tests. This change updates existing snapshots to replace any goo.gl links with full, unshortened URLs."}),"\n",(0,i.jsx)(n.h3,{id:"error-causes-in-snapshots",children:"Error Causes in Snapshots"}),"\n",(0,i.jsxs)(n.p,{children:["Error serialization in snapshots has changed. Jest 30\u2019s snapshot serializer will now include an ",(0,i.jsx)(n.code,{children:"Error"}),"\u2019s ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"cause"})})," property (if present) when printing errors."]}),"\n",(0,i.jsx)(n.h3,{id:"react-empty-string-rendering",children:"React Empty String Rendering"}),"\n",(0,i.jsxs)(n.p,{children:["The React-specific snapshot serializer no longer renders empty string children (",(0,i.jsx)(n.code,{children:'""'}),") in the output. In Jest 29, an empty string child in a React element might appear as ",(0,i.jsx)(n.code,{children:'""'})," in the snapshot output; in Jest 30 it will be omitted (treated as no content)."]}),"\n",(0,i.jsxs)(n.h3,{id:"improved-object-printing-in-pretty-format",children:["Improved Object Printing in ",(0,i.jsx)(n.code,{children:"pretty-format"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ArrayBuffer"})," and ",(0,i.jsx)(n.code,{children:"DataView"})," are now printed in a human-readable way instead of as objects with internal fields."]}),"\n",(0,i.jsx)(n.h2,{id:"jest-mock-api-changes",children:"Jest Mock API Changes"}),"\n",(0,i.jsxs)(n.h3,{id:"jestgenmockfrommodule-removed",children:[(0,i.jsx)(n.code,{children:"jest.genMockFromModule"})," Removed"]}),"\n",(0,i.jsxs)(n.p,{children:["The legacy function ",(0,i.jsx)(n.code,{children:"jest.genMockFromModule(moduleName)"})," has been removed. It was previously deprecated in favor of ",(0,i.jsx)(n.code,{children:"jest.createMockFromModule(moduleName)"}),". If you still use ",(0,i.jsx)(n.code,{children:"genMockFromModule"}),", switch to ",(0,i.jsx)(n.code,{children:"createMockFromModule"})," \u2013 the behavior is the same. For example:"]}),"\n",(0,i.jsx)(n.p,{children:"Old code (Jest 29):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const mockFs = jest.genMockFromModule('fs');\n"})}),"\n",(0,i.jsx)(n.p,{children:"New code (Jest 30):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const mockFs = jest.createMockFromModule('fs');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"removed-mock-function-types",children:"Removed Mock Function Types"}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"The type changes are only applicable if you explicitly import Jest APIs:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import {expect, jest, test} from '@jest/globals';\n"})})]}),"\n",(0,i.jsx)(n.p,{children:"Some TypeScript types related to mock functions have been removed from the public API."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"MockFunctionMetadata"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"MockFunctionMetadataType"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"SpyInstance"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If you were using ",(0,i.jsx)(n.code,{children:"jest.SpyInstance"})," (for instance, to annotate the return of ",(0,i.jsx)(n.code,{children:"jest.spyOn"}),"), you should update to using ",(0,i.jsx)(n.a,{href:"/zh-Hans/docs/next/mock-function-api#jestspiedsource",children:(0,i.jsx)(n.code,{children:"jest.Spied"})}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"module--runtime-changes",children:"Module & Runtime Changes"}),"\n",(0,i.jsx)(n.h3,{id:"esm-module-support-and-internal-restructuring",children:"ESM Module Support and Internal Restructuring"}),"\n",(0,i.jsx)(n.p,{children:"Jest has introduced significant under-the-hood changes to how its packages are bundled and exported:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["All of Jest\u2019s internal modules are now bundled into single files for faster startup. This means when you install Jest, the number of files it loads is greatly reduced (improving performance). However, a side effect is that any unofficial deep imports into Jest\u2019s packages will likely break. For example, if you previously did something like ",(0,i.jsx)(n.code,{children:"require('jest-runner/build/testWorker')"})," (which is not a public API), this path will no longer exist. ",(0,i.jsx)(n.strong,{children:"Solution:"})," Use Jest\u2019s public APIs or documented interfaces only. If you are relying on an internal module that you think should be part of the public API, please open a Pull Request to expose it."]}),"\n",(0,i.jsxs)(n.li,{children:["Jest\u2019s packages now provide ESM wrappers. This is part of ongoing work to allow running Jest in an ESM context. All official Jest packages export themselves properly via the ",(0,i.jsx)(n.code,{children:"package.json"})," ",(0,i.jsx)(n.code,{children:'"exports"'})," field. For most users, this has no direct impact \u2013 you continue to use Jest the same way. But if you maintain a tool or plugin that imports Jest\u2019s modules, ensure you use the package names as imports (which will resolve via Node\u2019s module resolution)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["These changes are considered breaking for anyone poking at Jest\u2019s internals, but ",(0,i.jsx)(n.strong,{children:"not"})," for typical usage of the Jest CLI and config. After upgrading, run your tests normally \u2013 if you get module resolution errors related to Jest\u2019s own modules, it\u2019s likely due to an unsupported import that needs to be removed or updated."]}),"\n",(0,i.jsx)(n.h3,{id:"glob-pattern-matching-changes",children:"Glob Pattern Matching Changes"}),"\n",(0,i.jsxs)(n.p,{children:["Jest\u2019s dependency for file pattern matching (",(0,i.jsx)(n.code,{children:"glob"}),") has been upgraded to v10. Glob v10 may have slight differences in pattern syntax and behavior."]}),"\n",(0,i.jsxs)(n.p,{children:["One notable change is that ",(0,i.jsx)(n.code,{children:"glob@10"})," treats brace expansions and extglobs a bit differently and is stricter about some patterns. If you have custom ",(0,i.jsx)(n.code,{children:"testMatch"})," patterns, ",(0,i.jsx)(n.code,{children:"moduleNameMapper"})," patterns, or other glob-based config, they should continue to work in most cases. Just be aware that if a pattern isn\u2019t matching files as it used to, you might need to adjust it for the new glob engine."]}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["Upgrade to Jest 30 by first ensuring your environment meets the new Node.js and TypeScript requirements. Update your Jest configuration file and CLI usage for the renamed and removed options (notably ",(0,i.jsx)(n.code,{children:"testPathPatterns"})," and the removal of ",(0,i.jsx)(n.code,{children:"--init"}),"). Run your test suite and address any failures:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fix tests using removed matcher aliases by replacing them with the official matcher names."}),"\n",(0,i.jsx)(n.li,{children:"Update any snapshots that fail due to the formatting changes (error causes, empty strings, etc.)."}),"\n",(0,i.jsxs)(n.li,{children:["Pay attention to TypeScript compiler errors \u2013 they will guide you to update deprecated API usage (like ",(0,i.jsx)(n.code,{children:"genMockFromModule"})," or removed types) and adjust tests where types are now stricter."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Happy testing!"})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);